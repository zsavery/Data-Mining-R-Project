---
title: "Project 2: Building a Safer Health System"
output: html_notebook
---

```{r}
if(!require(pacman)) install.packages(pacman)
library(pacman)
pacman::p_load(tidyverse, psych, readxl, chron, lubridate)
```

```{r}
#Plugs file into variable
ICUEvents <- read_excel("ICUEvents.xlsx")
```


```{r}
newICU <- ICUEvents

```

-	Using R, perform a complete analysis of the dataset (with graphs) representing, for example, 
  - frequencies of medical errors 
  - medical errors correlation with 
    - day of the week
    - time of the day
    - staff member who made the error 
-	Since the dependent attribute Type_of_Error has multiple values (levels), select one type of error, you will train your classifier 
-	Check that the error  is sufficiently represented in the dataset.
-	Clean and prepare your data, using the methods seen in class
-	Train your classifier.
-	Write a report documenting your work: Dataset description, machine learning method and why it is suitable, Training and testing datasets, and the model evaluation.

```{r}
# Lets you view document
# view(newICU)
```


```{r}
# Remove useless column
newICU <- subset(newICU, select= -...11)
```


```{r}
#Summarizes doc
summary(newICU)
```


```{r}
#Gives you the data types of features
str(newICU)
```


```{r}
#Displays doc
newICU
```


```{r}
#Gives you names of features
names(newICU)
```
```{r}
# Factor 
newICU$`Date-of-error` <- as.Date(newICU$`Date-of-error`, tryFormats = c("%d-%m-%Y", "%d/%m/%y"))

```


```{r}
newICU$`Error-category` <- factor(newICU$`Error-category`)
```


```{r}
newICU$`Type-of-error` <- factor(newICU$`Type-of-error`)
newICU$`Cause-of-error` <- factor(newICU$`Cause-of-error`)
```


```{r}
newICU$`Contributing-factor` <- factor(newICU$`Contributing-factor`)
newICU$`Medication-process-node` <- factor(newICU$`Medication-process-node`)
newICU$`Staff-type-initiated-error` <- factor(newICU$`Staff-type-initiated-error`)
newICU$`Staff-type-perpetuated-error` <- factor(newICU$`Staff-type-perpetuated-error`)
newICU$`Action-taken` <- factor(newICU$`Action-taken`)
newICU$`Staff-type-discovered-error` <- factor(newICU$`Staff-type-discovered-error`)

```

```{r}
summary(newICU)
```

```{r}


pairs(newICU[c('Error-category', 'Date-of-error')])
```


```{r}
#How large is the dataset
dim(newICU)
```


```{r}
#Number of attributes
nrow(newICU) * ncol(newICU)
```


```{r}
# First ten rows
head(newICU)
```


```{r}
# Column Names
colnames(newICU)
```


```{r}
new_data <- subset(newICU, select = c("Report-number", "Facility-ID","Error-category","Date-of-error", "Time-of-error","Day-of-week","Type-of-error","Cause-of-error", "Contributing-factor","Location-of-error", "Description-of-error", "Medication-process-node","Staff-type-initiated-error","Staff-type-perpetuated-error", "Staff-type-discovered-error","Action-taken","Action-taken-detail","Date-record-was-entered"))
```


```{r}
colnames(new_data)[colnames(new_data) %in% c("Report-Number", "Facility-ID", "Error-Category",                                           "Date-of-error","Time-of-error", "Day-of-week", "Type-of-error", "Cause-of-error", "Contributing-factor","Location-of-error","Description-of-error", "Medication-process-node","Staff-type-initiated-error","Staff-type-perpetuated-error", "Staff-type-discovered-error","Action-taken","Action-taken-detail","Date-record-was-entered")] <-
  c("Report_number","Facility_id","Error_category","Date_of_error","Time_of_error","Day_of_week","Type_of_error","Cause_of_error",
    "Contributing_factor","Location_of_error","11","Description_of_error","Medication_process_node","Staff_type_initiated_error",
    "Staff_type_perpetuated_error","Staff_type_discovered_error","Action_taken","Action_taken_detail","Date_record_was_entered")
```


```{r}
#Mistake; x must be numeric
# cor(new_data[c("Report_number","Facility_id","Error_category","Date_of_error","Type_of_error","Cause_of_error")])

# cor(new_data[c("Report_number","Facility_id")])
```


```{r}
#data_num <- as.data.frame(apply(new_data, 2, as.numeric))
#sapply(data_num, class)
```


```{r}
cor(data_num[c("Report_number","Facility_id")])
```


```{r}
cor(data_num[c("Report_number","Facility_id","Error_category","Date_of_error","Type_of_error","Cause_of_error")])
```


```{r}
ggplot(data=data_num)
plot(Date_of_error ~ Type_of_error, data = data_num, pch=16)

pairs(data_num)


library(tidyverse)
ggplot(data = data_num, mapping = aes(x = Date_of_error, y= Type_of_error))







```

